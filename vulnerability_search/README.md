# Vulnerability Search

## Table of Contents
- [How it Works (Architecture)](#how-it-works-architecture)
  - [1. Indexing (Handled by `main.py`)](#1-indexing-handled-by-mainpy)
  - [2. Searching (Handled by `app.py`)](#2-searching-handled-by-apppy)
- [Streamlit UI Integration](#streamlit-ui-integration)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Local Development](#local-development)
  - [Using Docker](#using-docker)
- [Project Structure](#project-structure)
- [Deployment](#deployment)
- [Dependencies](#dependencies)
- [Contributing](#contributing)
- [License](#license)

This project is a semantic search engine for a CVE (Common Vulnerabilities and Exposures) database. It uses a Streamlit web interface to provide a user-friendly way to search for vulnerabilities using natural language.

## How it Works (Architecture)

The application operates in two main phases: indexing and searching.

### 1. Indexing (Handled by `main.py`)

- The `CVEDataLoader` in `src/data_loader.py` fetches vulnerability data from the NVD (National Vulnerability Database) API.
- The `EmbeddingEngine` in `src/embedding_engine.py` processes each CVE's text and metadata, converting it into a rich document string. It then uses the `all-MiniLM-L6-v2` sentence-transformer model to create a vector embedding from this string.
- The `ChromaManager` in `src/chroma_manager.py` takes these embeddings, along with their metadata (like CVSS score, severity, etc.), and stores them in an in-memory ChromaDB vector database collection.
- The fetched data is saved to `data/cve_data.json`.

### 2. Searching (Handled by `app.py`)

- When the Streamlit app starts, the `initialize_search_engine` function (cached for performance) loads the data from `data/cve_data.json` and populates the ChromaDB database, similar to the indexing step.
- The user enters a natural language query (e.g., 'remote code execution in web servers') into the Streamlit UI.
- The `VulnerabilitySearch` class in `src/search_interface.py` orchestrates the search. It takes the user's query and uses the `EmbeddingEngine` to create a query vector.
- It builds a metadata filter based on the user's selections (e.g., Severity, CVSS score).
- It uses the `ChromaManager` to perform a similarity search on the vector database, finding the CVEs with embeddings closest to the query's embedding, while respecting the metadata filters.
- The results are formatted and displayed back to the user in the Streamlit interface.

## Streamlit UI Integration

The file `app.py` is dedicated to the user interface.

- It uses `st.title`, `st.write`, and `st.columns` to create the page layout.
- Interactive widgets like `st.text_input` (for the search query), `st.selectbox` (for severity), and `st.slider` (for CVSS score and number of results) are used to collect user input.
- `st.button` triggers the search operation.
- `st.spinner` provides user feedback during long operations like initialization and searching.
- The results are displayed in an organized manner using `st.expander` for each vulnerability, allowing the user to view details on demand.
- Crucially, `@st.cache_resource` is used to ensure the expensive process of loading data and initializing the search engine only happens once, making the app responsive on subsequent interactions.

## Getting Started

### Prerequisites

- Python 3.8+
- Docker (optional)

### Local Development

1. **Clone the repository:**
   ```bash
   git clone https://github.com/Prosen-Ghosh/llm_demo.git
   cd vulnerability_search
   ```

2. **Create a virtual environment and activate it:**
   ```bash
   python3 -m venv vulnerability_search_env
   source vulnerability_search_env/bin/activate
   ```

3. **Install the required packages:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Fetch the CVE data:**
    ```bash
    python main.py
    ```

5. **Run the Streamlit app:**
   ```bash
   streamlit run app.py
   ```

### Using Docker

1. **Fetch the CVE data:**
    ```bash
    python main.py
    ```

2. **Run with Docker:**
    ```bash
    docker build -t vulnerability-search .
    docker run -p 8501:8501 -v $(pwd)/data:/app/data vulnerability-search
    ```

## Project Structure

```
.
â”œâ”€â”€ .gitignore
â”œâ”€â”€ app.py
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ main.py
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ data/
â”‚   â””â”€â”€ cve_data.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ chroma_manager.py
â”‚   â”œâ”€â”€ data_loader.py
â”‚   â”œâ”€â”€ embedding_engine.py
â”‚   â””â”€â”€ search_interface.py
â””â”€â”€ vulnerability_search_env/
```

## Deployment

This application is containerized using Docker, which makes it easy to deploy to any cloud provider that supports Docker containers. Here are the general steps to deploy this application:

1. **Build the Docker image:**
   ```bash
   docker build -t vulnerability-search .
   ```

2. **Push the Docker image to a container registry:**
   ```bash
   docker push your-container-registry/vulnerability-search
   ```

3. **Configure the environment variables in your cloud provider's environment.**

4. **Deploy the container.**

For more detailed instructions, please refer to your cloud provider's documentation.

## Dependencies

- `sentence-transformers`
- `chromadb`
- `requests`
- `beautifulsoup4`
- `pandas`
- `numpy`
- `streamlit`
- `python-dotenv`

## ğŸ¤ Contributing

Contributions are welcome! If you have suggestions for improvements or new features, please feel free to open an issue or submit a pull request.

## License

This project is licensed under the MIT License.